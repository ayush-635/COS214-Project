- name: Build project and tests
  run: |
    set -e
    mkdir -p build

    # Compile only .cpp files that contain implementations (no partial files)
    for file in $(find src -maxdepth 1 -name '*.cpp' ! -name '*_partial.cpp' ! -name '*_stub.cpp'); do
      echo "Compiling $file"
      g++ $CXXFLAGS -c $file -o build/$(basename ${file%.cpp}.o)
    done

    if [ -n "$TEST_FILES" ]; then
      echo "Compiling test files..."
      g++ $CXXFLAGS $TEST_FILES build/*.o $INCLUDE_FLAGS -o $BUILD_EXE
    else
      echo "No test files found!"
      exit 1
    fi
